<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<script>
    var http_pelis;
    var archivoPelis;
    var raizPelis;
    var peliculas;
    var http_sinopsis;
    window.onload=inicio;
    function inicio(){
        let boton = document.getElementById("enviar");

        boton.addEventListener("click", cargarInfo);

    }
    function cargarInfo(event) {
        event.preventDefault();
        http_pelis=new XMLHttpRequest();
        let url="http://localhost/DEC/Ejercicios%20AJAX/ejercicio3/index.php";
        http_pelis.open("GET", url, true);
        http_pelis.onreadystatechange=cargarDirectores;
        http_pelis.send(null);
    }

    function cargarDirectores() {       

        let selectDirectores=document.getElementById("directores");
        if(http_pelis.readyState==4){
            if(http_pelis.status==200){
                archivoPelis=http_pelis.responseXML;
                raizPelis=archivoPelis.getElementsByTagName("Peliculas")[0];
                peliculas=raizPelis.getElementsByTagName("Pelicula");
                for (let i = 0; i < peliculas.length; i++) {
                    let peli = peliculas[i];
                    let director=peli.getElementsByTagName("Director")[0].childNodes[0].nodeValue;
                    if(!existe(director)){
                        let option=document.createElement("option");
                        option.textContent=director;
                        option.value=director;
                        // console.log(option.textContent);
                        option.addEventListener("click",cargarTitulos);
                        selectDirectores.appendChild(option);
                    }
                    
                }
            }
        }
    }

    function cargarTitulos() {       
        console.log(this.value);
        let director=this.value;
        let selectTitulos=document.getElementById("titulos");
        if(http_pelis.readyState==4){
            if(http_pelis.status==200){
                for (let i = 0; i < peliculas.length; i++) {
                    let peli = peliculas[i];
                    let option=document.createElement("option");
                    option.value=peli.getElementsByTagName("sinopsis")[0].childNodes[0].nodeValue;
                    option.id=peli.getElementsByTagName("sinopsis")[0].childNodes[0].nodeValue;
                    option.textContent=peli.getElementsByTagName("Director")[0].childNodes[0].nodeValue;
                    
                }
            }
        }
    }
    function existe(nombre){
        console.log("hola");
        for (let i = 0; i < peliculas.length; i++) {
        // console.log(peliculas[i].getElementsByTagName("Director")[0].childNodes[0].nodeValue);

            if (peliculas[i].getElementsByTagName("Director")[0].childNodes[0].nodeValue == nombre) {
        console.log(peliculas[i].getElementsByTagName("Director")[0].childNodes[0].nodeValue);
                
                return true; 
            }
        }
        return false;
    }
</script>
<body>
    <input type="button" id="enviar" value="Enviar">
    <select id="directores">
        <option value="0">--Directores--</option>
    </select>
    <select id="titulos">
        <option value="0">--Titulos--</option>

    </select>
    <div id="mostrar"></div>
</body>
</html>